<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-LCT9JGKKYQ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-LCT9JGKKYQ');
  </script>
  
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Extractingo: Professional Email Generator Tool with Auto-Personalization">
  <meta name="keywords" content="email generator, auto personalization, smart email, bulk email">
  <meta name="author" content="El Uthmaaniy">
  
  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="Extractingo - Smart Email Generator with Auto-Personalization">
  <meta property="og:description" content="Generate emails with auto-personalization. Opens in Gmail with auto-filled content.">
  <meta property="og:url" content="https://emailtools.blogspot.com/">
  <meta property="og:type" content="website">
  
  <title>Extractingo - Smart Email Generator with Auto-Personalization</title>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap" rel="stylesheet">
  
  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.2.0/remixicon.min.css"/>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            'google-sans': ['Google Sans', 'sans-serif'],
          },
          colors: {
            'google-blue': '#4285F4',
            'google-red': '#EA4335', 
            'google-yellow': '#FBBC05',
            'google-green': '#34A853',
          }
        }
      },
      darkMode: 'class'
    }
  </script>
  
  <style>
    :root {
      --primary-blue: #4285F4;
      --primary-green: #34A853;
      --primary-red: #EA4335;
      --primary-yellow: #FBBC05;
    }
    
    body {
      font-family: 'Google Sans', sans-serif;
      font-size: 14px;
    }
    
    * {
      transition: background-color 0.3s ease, 
                  color 0.3s ease, 
                  border-color 0.3s ease;
    }
    
    .btn-primary {
      background: #4285F4;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      font-weight: 500;
      transition: all 0.3s ease;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }
    
    .btn-primary:hover {
      background: #3367d6;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3);
    }
    
    .btn-secondary {
      background: transparent;
      color: #4285F4;
      border: 1px solid #4285F4;
      padding: 10px 20px;
      border-radius: 6px;
      font-weight: 500;
      transition: all 0.3s ease;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }
    
    .btn-secondary:hover {
      background: #4285F4;
      color: white;
    }
    
    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #4285F4;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #34A853;
      color: white;
      padding: 12px 20px;
      border-radius: 6px;
      font-size: 14px;
      z-index: 1000;
      transform: translateX(120%);
      transition: transform 0.3s ease;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .notification.error {
      background: #EA4335;
    }
    
    .notification.warning {
      background: #FBBC05;
      color: #202124;
    }
    
    .notification.info {
      background: #4285F4;
    }
    
    /* Email item styling */
    .email-item {
      padding: 10px 15px;
      border-bottom: 1px solid #E8EAED;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .email-item:hover {
      background: #F8F9FA;
    }
    
    .dark .email-item:hover {
      background: #2D3748;
    }
    
    .email-item.clicked {
      color: #E37400;
    }
    
    .email-item.gmail-opened {
      background: #E8F0FE;
      color: #4285F4;
    }
    
    .dark .email-item.gmail-opened {
      background: #2E3A4D;
    }
    
    .email-item.personalized {
      background: #E8F0FE;
      color: #4285F4;
    }
    
    .dark .email-item.personalized {
      background: #2E3A4D;
    }
    
    .personalization-badge {
      background: #34A853;
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
    }
    
    .email-status {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }
    
    .status-sent {
      background: #34A853;
    }
    
    .status-pending {
      background: #FBBC05;
    }
    
    .email-number {
      color: #5F6368;
      min-width: 25px;
      font-size: 13px;
    }
    
    .email-address {
      flex: 1;
      font-size: 14px;
    }
    
    .gmail-icon {
      color: #EA4335;
    }
    
    /* Tab styling */
    .tab-button {
      padding: 10px 20px;
      border: none;
      background: none;
      color: #5F6368;
      font-weight: 500;
      cursor: pointer;
      border-bottom: 2px solid transparent;
    }
    
    .tab-button.active {
      color: #4285F4;
      border-bottom-color: #4285F4;
    }
    
    /* Stats card styling */
    .stats-card {
      background: #F8F9FA;
      border-radius: 8px;
      padding: 15px;
      border: 1px solid #E8EAED;
    }
    
    .dark .stats-card {
      background: #2D3748;
      border-color: #4A5568;
    }
    
    .stats-value {
      font-size: 24px;
      font-weight: 600;
      line-height: 1.2;
    }
    
    .stats-label {
      font-size: 12px;
      color: #5F6368;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    /* Anti-spam tips */
    .anti-spam-tip {
      background: #FFF3CD;
      border: 1px solid #FFEEBA;
      border-radius: 6px;
      padding: 12px;
      margin-top: 10px;
    }
    
    .dark .anti-spam-tip {
      background: #4A3C1A;
      border-color: #6B5C33;
    }
    
    .anti-spam-tip i {
      color: #E6A700;
    }
    
    /* Text area styling */
    textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #DADCE0;
      border-radius: 6px;
      font-family: 'Google Sans', sans-serif;
      font-size: 14px;
      resize: vertical;
    }
    
    .dark textarea {
      background: #2D3748;
      border-color: #4A5568;
      color: #E2E8F0;
    }
    
    textarea:focus {
      outline: none;
      border-color: #4285F4;
      box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
    }
    
    /* Input styling */
    input[type="text"],
    input[type="email"] {
      padding: 10px 12px;
      border: 1px solid #DADCE0;
      border-radius: 6px;
      font-size: 14px;
    }
    
    .dark input[type="text"],
    .dark input[type="email"] {
      background: #2D3748;
      border-color: #4A5568;
      color: #E2E8F0;
    }
    
    input:focus {
      outline: none;
      border-color: #4285F4;
      box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
    }
    
    /* Generated emails container */
    .generated-emails-container {
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid #E8EAED;
      border-radius: 8px;
      background: white;
    }
    
    .dark .generated-emails-container {
      background: #2D3748;
      border-color: #4A5568;
    }
    
    /* Spam score indicator */
    .spam-score {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .spam-score-low {
      background: #34A853;
      color: white;
    }
    
    .spam-score-medium {
      background: #FBBC05;
      color: #202124;
    }
    
    .spam-score-high {
      background: #EA4335;
      color: white;
    }
    
    /* Checkbox styling */
    input[type="checkbox"] {
      width: 16px;
      height: 16px;
      border-radius: 4px;
      border: 2px solid #DADCE0;
      cursor: pointer;
    }
    
    input[type="checkbox"]:checked {
      background-color: #4285F4;
      border-color: #4285F4;
    }
    
    /* Auto-mode toggle */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }
    
    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    
    input:checked + .toggle-slider {
      background-color: #4285F4;
    }
    
    input:checked + .toggle-slider:before {
      transform: translateX(26px);
    }
    
    /* Scrollbar styling */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #F1F3F4;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #DADCE0;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #BDC1C6;
    }
    
    .dark ::-webkit-scrollbar-track {
      background: #4A5568;
    }
    
    .dark ::-webkit-scrollbar-thumb {
      background: #718096;
    }
    
    .dark ::-webkit-scrollbar-thumb:hover {
      background: #A0AEC0;
    }
    
    /* Spam check section */
    .spam-check {
      background: #F8F9FA;
      border: 1px solid #E8EAED;
      border-radius: 8px;
      padding: 15px;
      margin-top: 10px;
    }
    
    .dark .spam-check {
      background: #2D3748;
      border-color: #4A5568;
    }
    
    .spam-issue {
      color: #EA4335;
      font-size: 13px;
      margin-top: 5px;
    }
    
    .spam-fixed {
      color: #34A853;
      font-size: 13px;
      margin-top: 5px;
    }
    
    /* Auto-personalization indicator */
    .auto-personalization {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 10px 15px;
      border-radius: 8px;
      margin: 10px 0;
    }
    
    .personalization-status {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 5px 0;
      font-size: 13px;
    }
    
    .personalization-icon {
      color: #34A853;
    }
    
    /* Variable detection */
    .variable-detection {
      background: #E8F0FE;
      border: 1px solid #DADCE0;
      border-radius: 6px;
      padding: 12px;
      margin-top: 10px;
    }
    
    .dark .variable-detection {
      background: #2D3748;
      border-color: #4A5568;
    }
    
    .variable-highlight {
      background: #FFF3CD;
      border: 1px solid #FFEEBA;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
    }
    
    .dark .variable-highlight {
      background: #5D4200;
      border-color: #FFC107;
    }
    
    /* Load Sample Data Button */
    .btn-sample {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 6px;
      font-weight: 500;
      transition: all 0.3s ease;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }
    
    .btn-sample:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
  </style>
</head>

<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white transition-colors duration-300">

<!-- Notification -->
<div id="notification" class="notification">
  <span id="notification-text"></span>
</div>

<!-- Header -->
<header class="bg-white dark:bg-gray-800 py-4 shadow-sm border-b border-gray-200 dark:border-gray-700">
  <div class="container mx-auto px-4 md:px-6">
    <div class="flex justify-between items-center">
      <div class="text-2xl font-bold">
        <a href="https://emailtools.blogspot.com/" target="_blank" class="flex items-center">
          <span class="text-google-blue">Extrac</span><span class="text-google-green">tingo</span>
        </a>
      </div>
      <nav class="hidden md:flex items-center space-x-6">
        <a href="#email-generator" class="text-gray-600 dark:text-gray-300 hover:text-google-blue font-medium">Email Generator</a>
        <a href="https://scoutier.com.ng" class="text-gray-600 dark:text-gray-300 hover:text-google-green font-medium">Scoutier</a>
        <a href="https://emailtools.blogspot.com/" class="text-gray-600 dark:text-gray-300 hover:text-google-blue font-medium" target="_blank">Blog</a>
      </nav>
      <button id="darkModeToggle" class="text-google-yellow hover:text-google-red p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
        <i class="ri-moon-line ri-lg hidden dark:block"></i>
        <i class="ri-sun-line ri-lg block dark:hidden"></i>
      </button>
    </div>
  </div>
</header>

<!-- Main Content -->
<main class="min-h-screen py-8">
  <div class="container mx-auto px-4 md:px-6">
    <!-- Title -->
    <div class="text-center mb-8">
      <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-2">
        <i class="ri-mail-send-line text-google-blue"></i> Smart Email Generator
      </h1>
      <p class="text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">
        Generate emails with auto-personalization. Opens directly in email app with auto-filled content.
      </p>
    </div>

    <!-- Auto-Personalization Banner -->
    <div class="mb-8 max-w-6xl mx-auto">
      <div class="auto-personalization">
        <div class="flex items-center justify-between">
          <div>
            <h3 class="font-semibold flex items-center">
              <i class="ri-ai-generate mr-2"></i> Auto-Personalization Active
            </h3>
            <p class="text-sm opacity-90">Variables like {name} will be auto-filled when emails are generated</p>
          </div>
          <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-xs font-medium">
            Uses mailto:
          </span>
        </div>
        
        <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="personalization-status">
            <i class="ri-checkbox-circle-fill personalization-icon"></i>
            <span>Auto-detects {name} in subject/body</span>
          </div>
          <div class="personalization-status">
            <i class="ri-checkbox-circle-fill personalization-icon"></i>
            <span>Extracts names from email addresses</span>
          </div>
          <div class="personalization-status">
            <i class="ri-checkbox-circle-fill personalization-icon"></i>
            <span>Opens email app with mailto:</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Anti-Spam Banner -->
    <div class="mb-8 max-w-6xl mx-auto">
      <div class="anti-spam-tip flex items-start">
        <i class="ri-shield-check-line ri-lg mr-3 mt-1"></i>
        <div>
          <strong>Spam-Free Guarantee:</strong> This tool NEVER sends emails from our servers. 
          Emails open directly in your email app - you control the sending. 
          We provide spam-check tools to ensure your emails don't get flagged.
        </div>
      </div>
    </div>

    <!-- Main Tool Container -->
    <div class="max-w-6xl mx-auto bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden">
      
      <!-- Tool Header -->
      <div class="border-b border-gray-200 dark:border-gray-700 px-6 py-4">
        <div class="flex flex-wrap justify-between items-center gap-4">
          <div class="flex items-center space-x-4">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white">
              Email Campaign Generator
            </h2>
            <span class="px-3 py-1 bg-google-green text-white text-xs font-medium rounded-full">
              mailto: Protocol
            </span>
          </div>
          <div class="flex items-center space-x-3">
            <button onclick="toggleAdvancedOptions()" class="btn-secondary text-sm">
              <i class="ri-settings-3-line mr-2"></i>Advanced Options
            </button>
            <button onclick="previewEmail()" class="btn-secondary text-sm">
              <i class="ri-eye-line mr-2"></i>Preview
            </button>
            <button onclick="testInGmail()" class="btn-secondary text-sm">
              <i class="ri-mail-line mr-2"></i>Test Email
            </button>
            <button onclick="generateEmails()" class="btn-primary bg-google-green hover:bg-green-600">
              <i class="ri-mail-send-line mr-2"></i>Generate Emails
            </button>
          </div>
        </div>
      </div>

      <!-- Tool Body -->
      <div class="p-6">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          
          <!-- Left Column: Email Configuration -->
          <div class="space-y-6">
            
            <!-- Recipients Section -->
            <div>
              <div class="flex items-center justify-between mb-3">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                  # Recipients Email
                </h3>
                <div class="flex items-center space-x-2">
                  <button onclick="loadSampleEmails()" class="btn-sample text-sm">
                    <i class="ri-download-line mr-1"></i>Load Sample
                  </button>
                  <button onclick="clearRecipients()" class="text-sm text-google-red hover:text-red-700">
                    <i class="ri-eraser-line mr-1"></i>Clear
                  </button>
                  <button onclick="validateEmails()" class="text-sm text-google-green hover:text-green-700">
                    <i class="ri-shield-check-line mr-1"></i>Validate
                  </button>
                </div>
              </div>
              
              <textarea id="recipient-emails" rows="10"
                class="w-full p-4 border border-gray-300 dark:border-gray-600 rounded-lg font-mono text-sm"
                placeholder="Enter each email on a new line (one per line):

You can add your own emails here...

Or click 'Load Sample' to load sample emails."></textarea>
              
              <!-- Stats Cards -->
              <div id="email-stats" class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-3">
                <div class="stats-card">
                  <div class="stats-value text-google-green" id="valid-count">0</div>
                  <div class="stats-label">Valid</div>
                </div>
                <div class="stats-card">
                  <div class="stats-value text-google-red" id="invalid-count">0</div>
                  <div class="stats-label">Invalid</div>
                </div>
                <div class="stats-card">
                  <div class="stats-value text-google-blue" id="total-count">0</div>
                  <div class="stats-label">Total</div>
                </div>
                <div class="stats-card">
                  <div class="stats-value text-google-yellow" id="duplicates-count">0</div>
                  <div class="stats-label">Duplicates</div>
                </div>
              </div>
              
              <!-- Variable Detection -->
              <div id="variable-detection" class="variable-detection hidden">
                <div class="flex items-center justify-between mb-2">
                  <h4 class="text-sm font-medium text-gray-900 dark:text-white">
                    <i class="ri-ai-generate mr-2"></i> Variables Detected
                  </h4>
                  <span id="variable-count" class="text-xs px-2 py-1 bg-google-blue text-white rounded-full">0</span>
                </div>
                <div id="detected-variables" class="text-sm text-gray-600 dark:text-gray-400">
                  <!-- Variables will appear here -->
                </div>
              </div>
            </div>

            <!-- Subject Line -->
            <div>
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-3">
                Subject Line <span class="text-gray-500 text-sm font-normal">(Max 200 characters)</span>
              </h3>
              <div class="relative">
                <input type="text" id="email-subject" maxlength="200"
                  class="w-full p-4 border border-gray-300 dark:border-gray-600 rounded-lg pr-20"
                  placeholder="Hello {name}, updates from our team">
                <div class="absolute right-3 top-3 text-sm text-gray-500">
                  <span id="subject-length">0</span>/200
                </div>
              </div>
              
              <!-- Variable Suggestions -->
              <div class="mt-2 text-sm text-gray-600 dark:text-gray-400">
                Use variables: 
                <button onclick="insertVariable('name')" class="variable-highlight mx-1 hover:bg-yellow-100 dark:hover:bg-yellow-900 cursor-pointer">{name}</button>
                <button onclick="insertVariable('company')" class="variable-highlight mx-1 hover:bg-yellow-100 dark:hover:bg-yellow-900 cursor-pointer">{company}</button>
                <button onclick="insertVariable('date')" class="variable-highlight mx-1 hover:bg-yellow-100 dark:hover:bg-yellow-900 cursor-pointer">{date}</button>
              </div>
              
              <!-- Spam Check for Subject -->
              <div id="subject-spam-check" class="spam-check hidden mt-3">
                <div class="flex items-center justify-between mb-2">
                  <h4 class="text-sm font-medium text-gray-900 dark:text-white">Subject Spam Analysis</h4>
                  <span class="spam-score spam-score-low" id="subject-spam-score">Low Risk</span>
                </div>
                <div id="subject-spam-issues"></div>
              </div>
            </div>

            <!-- Advanced Options (Collapsible) -->
            <div id="advanced-options" class="hidden space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                    Your Name (Sender)
                  </label>
                  <input type="text" id="from-name"
                    class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg"
                    placeholder="Your Name">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                    Your Email (Reply-to)
                  </label>
                  <input type="email" id="from-email"
                    class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg"
                    placeholder="your-email@gmail.com">
                </div>
              </div>
              
              <!-- Personalization Settings -->
              <div>
                <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Personalization Settings</h4>
                <div class="space-y-2">
                  <label class="flex items-center space-x-2">
                    <input type="checkbox" id="auto-detect-names" checked class="rounded text-google-blue">
                    <span class="text-sm">Auto-detect names from emails</span>
                  </label>
                  <label class="flex items-center space-x-2">
                    <input type="checkbox" id="auto-capitalize" checked class="rounded text-google-blue">
                    <span class="text-sm">Auto-capitalize extracted names</span>
                  </label>
                  <label class="flex items-center space-x-2">
                    <input type="checkbox" id="include-date" checked class="rounded text-google-blue">
                    <span class="text-sm">Include {date} automatically</span>
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Right Column: Email Content & Results -->
          <div class="space-y-6">
            
            <!-- Message Body -->
            <div>
              <div class="flex items-center justify-between mb-3">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                  Message Body <span class="text-gray-500 text-sm font-normal">(Max 2000 characters)</span>
                </h3>
                <div class="flex items-center space-x-2">
                  <button onclick="checkSpam()" class="btn-secondary text-sm">
                    <i class="ri-shield-star-line mr-1"></i>Check Spam Score
                  </button>
                  <div class="text-sm text-gray-500">
                    <span id="body-length">0</span>/2000
                  </div>
                </div>
              </div>
              
              <textarea id="email-body" rows="12" maxlength="2000"
                class="w-full p-4 border border-gray-300 dark:border-gray-600 rounded-lg"
                placeholder="Write your email message here...

Example template:
Dear {name},

We hope this email finds you well. We wanted to share some exciting updates...

Best regards,
{your_name}"></textarea>
              
              <!-- Spam Check Results -->
              <div id="spam-results" class="spam-check hidden mt-3">
                <div class="flex items-center justify-between mb-2">
                  <h4 class="text-sm font-medium text-gray-900 dark:text-white">
                    <i class="ri-shield-star-line mr-2 text-google-blue"></i>
                    Spam Analysis Results
                  </h4>
                  <span class="spam-score" id="overall-spam-score">Checking...</span>
                </div>
                <div id="spam-issues" class="space-y-2">
                  <!-- Issues will appear here -->
                </div>
                <div id="spam-suggestions" class="mt-3 text-sm text-gray-600 dark:text-gray-400">
                  <!-- Suggestions will appear here -->
                </div>
              </div>
              
              <!-- Formatting Tools -->
              <div class="mt-3 flex flex-wrap gap-2">
                <button onclick="formatText('bold')" class="px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-700">
                  <i class="ri-bold mr-1"></i>Bold
                </button>
                <button onclick="formatText('italic')" class="px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-700">
                  <i class="ri-italic mr-1"></i>Italic
                </button>
                <button onclick="insertVariable('name')" class="px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-700">
                  {name}
                </button>
                <button onclick="insertVariable('company')" class="px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-700">
                  {company}
                </button>
                <button onclick="insertVariable('date')" class="px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-700">
                  {date}
                </button>
              </div>
            </div>

            <!-- Generated Emails Section (Initially hidden) -->
            <div id="generated-emails-section" class="hidden">
              <div class="flex items-center justify-between mb-3">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                  <i class="ri-gmail-line gmail-icon mr-2"></i># Generated Emails
                </h3>
                <div class="flex items-center space-x-4">
                  <div class="text-sm text-gray-500">
                    <span class="text-google-blue">Ctrl+Click</span> = multi-select
                  </div>
                </div>
              </div>
              
              <div class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                Click any email to open your email app with auto-filled content. 
                <span class="text-google-green">Personalized emails have badge</span>. 
              </div>
              
              <!-- Tabs -->
              <div class="flex border-b border-gray-200 dark:border-gray-700 mb-4">
                <button onclick="showEmailTab('all')" class="tab-button active" data-tab="all">
                  All
                </button>
                <button onclick="showEmailTab('opened')" class="tab-button" data-tab="opened">
                  <i class="ri-check-line mr-1"></i>Opened
                </button>
                <button onclick="showEmailTab('pending')" class="tab-button" data-tab="pending">
                  <i class="ri-time-line mr-1"></i>Pending
                </button>
              </div>
              
              <!-- Generated Emails List -->
              <div id="generated-emails-container" class="generated-emails-container">
                <!-- Emails will be dynamically added here -->
              </div>
              
              <!-- Email Actions -->
              <div class="mt-4 flex justify-between items-center">
                <div class="text-sm text-gray-600 dark:text-gray-400">
                  <span id="selected-count">0</span> selected | 
                  <span id="opened-count">0</span> opened in Email App
                </div>
                <div class="flex space-x-2">
                  <button onclick="openSelectedInGmail()" class="btn-secondary">
                    <i class="ri-mail-line mr-2"></i>Open Selected in Email App
                  </button>
                  <button onclick="exportEmails()" class="btn-primary">
                    <i class="ri-download-line mr-2"></i>Export List
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- How It Works -->
    <div class="mt-8 max-w-6xl mx-auto bg-gradient-to-r from-blue-50 to-purple-50 dark:from-gray-800 dark:to-gray-900 rounded-lg p-6">
      <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
        <i class="ri-question-line mr-2 text-google-blue"></i> How mailto: Protocol Works
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="bg-white dark:bg-gray-700 p-4 rounded-lg">
          <div class="text-2xl text-google-blue mb-2">
            <i class="ri-mail-add-line"></i>
          </div>
          <h4 class="font-medium mb-1">1. Generate Emails</h4>
          <p class="text-sm text-gray-600 dark:text-gray-400">Add recipients, subject, and body then click Generate</p>
        </div>
        <div class="bg-white dark:bg-gray-700 p-4 rounded-lg">
          <div class="text-2xl text-google-green mb-2">
            <i class="ri-cursor-click-line"></i>
          </div>
          <h4 class="font-medium mb-1">2. Click Email</h4>
          <p class="text-sm text-gray-600 dark:text-gray-400">Click any email - uses mailto: to open your email app</p>
        </div>
        <div class="bg-white dark:bg-gray-700 p-4 rounded-lg">
          <div class="text-2xl text-google-red mb-2">
            <i class="ri-send-plane-line"></i>
          </div>
          <h4 class="font-medium mb-1">3. Send & Return</h4>
          <p class="text-sm text-gray-600 dark:text-gray-400">Send in your email app, return to browser, click next email</p>
        </div>
      </div>
    </div>
    
    <!-- Mobile Instructions -->
    <div class="mt-8 max-w-6xl mx-auto bg-yellow-50 dark:bg-yellow-900 border border-yellow-200 dark:border-yellow-700 rounded-lg p-4">
      <div class="flex items-start">
        <div class="text-yellow-600 dark:text-yellow-300 mr-3 mt-1">
          <i class="ri-information-line text-xl"></i>
        </div>
        <div>
          <h4 class="font-semibold text-gray-900 dark:text-white mb-2">Using mailto: Protocol:</h4>
          <ol class="list-decimal pl-5 space-y-1 text-sm text-gray-700 dark:text-gray-300">
            <li><strong>Click any email</strong> - Opens your default email app (Gmail if set as default)</li>
            <li><strong>Subject & body are pre-filled</strong> in your email app</li>
            <li><strong>Send the email</strong> manually in your email app</li>
            <li><strong>Return to this tab</strong> manually (back button or browser tabs)</li>
            <li><strong>Click next email</strong> to continue the process</li>
          </ol>
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
            Note: Works with any email app (Gmail, Outlook, Apple Mail, etc.) set as default on your device
          </p>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Footer -->
<footer class="bg-gray-50 dark:bg-gray-800 py-8 border-t border-gray-200 dark:border-gray-700 mt-8">
  <div class="container mx-auto px-4 md:px-6">
    <div class="text-center">
      <div class="text-2xl font-bold mb-4">
        <span class="text-google-blue">Extrac</span><span class="text-google-green">tingo</span>
      </div>
      <p class="text-gray-600 dark:text-gray-400 mb-4">
        Smart email tools with auto-personalization
      </p>
      <div class="flex justify-center space-x-6 mb-6">
        <a href="https://emailtools.blogspot.com/" class="text-gray-600 dark:text-gray-400 hover:text-google-blue" target="_blank">
          <i class="ri-global-line ri-lg"></i>
        </a>
        <a href="https://www.x.com/eluthmaaniy" class="text-gray-600 dark:text-gray-400 hover:text-google-blue" target="_blank">
          <i class="ri-twitter-x-fill ri-lg"></i>
        </a>
        <a href="mailto:help@emailtools.blogspot.com" class="text-gray-600 dark:text-gray-400 hover:text-google-blue">
          <i class="ri-mail-line ri-lg"></i>
        </a>
      </div>
      <div class="text-sm text-gray-500 dark:text-gray-400">
        &copy; <span id="currentYear"></span> Extractingo. 
        <span class="block mt-1">
          Visit our blog: 
          <a href="https://emailtools.blogspot.com/" class="text-google-blue hover:underline font-medium" target="_blank">
            emailtools.blogspot.com
          </a>
        </span>
        <p class="mt-2 text-xs">This tool doesn't send emails. It opens your email app with pre-filled content using mailto: protocol.</p>
      </div>
    </div>
  </div>
</footer>

<script>
// Email Generator with mailto: Protocol
class EmailGeneratorApp {
  constructor() {
    this.emails = [];
    this.generatedEmails = [];
    this.selectedEmails = new Set();
    this.currentTab = 'all';
    this.initialize();
  }

  initialize() {
    this.setupEventListeners();
    this.updateYear();
    this.setupTheme();
    this.scanForVariables();
  }

  setupEventListeners() {
    // Recipients textarea
    const recipientTextarea = document.getElementById('recipient-emails');
    recipientTextarea.addEventListener('input', () => {
      this.updateEmailStats();
      this.scanForVariables();
      this.saveRecipients(); // Save recipients as user types
    });

    // Subject line
    const subjectInput = document.getElementById('email-subject');
    subjectInput.addEventListener('input', () => {
      document.getElementById('subject-length').textContent = subjectInput.value.length;
      this.checkSubjectSpam();
      this.scanForVariables();
      this.saveSubject(); // Save subject as user types
    });

    // Message body
    const bodyTextarea = document.getElementById('email-body');
    bodyTextarea.addEventListener('input', () => {
      document.getElementById('body-length').textContent = bodyTextarea.value.length;
      this.scanForVariables();
      this.saveBody(); // Save body as user types
    });

    // Dark mode toggle
    document.getElementById('darkModeToggle').addEventListener('click', () => {
      document.documentElement.classList.toggle('dark');
      localStorage.setItem('theme', 
        document.documentElement.classList.contains('dark') ? 'dark' : 'light'
      );
    });

    // Personalization settings
    document.getElementById('auto-detect-names').addEventListener('change', this.scanForVariables.bind(this));
    document.getElementById('auto-capitalize').addEventListener('change', this.scanForVariables.bind(this));
    document.getElementById('include-date').addEventListener('change', this.scanForVariables.bind(this));

    // From name and email
    document.getElementById('from-name').addEventListener('input', () => {
      localStorage.setItem('extractingo-from-name', document.getElementById('from-name').value);
    });
    
    document.getElementById('from-email').addEventListener('input', () => {
      localStorage.setItem('extractingo-from-email', document.getElementById('from-email').value);
    });

    // Load saved data
    this.loadSavedData();
  }

  setupTheme() {
    const theme = localStorage.getItem('theme') || 'light';
    if (theme === 'dark') {
      document.documentElement.classList.add('dark');
    }
  }

  loadSampleData() {
    // Load sample recipients
    const sampleEmails = `soportesscenshop@proton.me
support@revanclub.store
contact@revanclub.store
service@plira.top
hello@kozie.fr
info@lokd.io
info@tecnosoluzioni.it
contact@lashfacile.com
info@nduclichicwithdignity.store
info@elurea.shop
info@boxipop.shop
infor@rapunzleluxe.com
info@rapunzleluxe.com
contact@simplitud.com
support@vitroot.org
info@dermadone.ca`;

    document.getElementById('recipient-emails').value = sampleEmails;
    this.updateEmailStats();
    
    // Trigger variable scan
    setTimeout(() => this.scanForVariables(), 100);
  }

  loadSavedData() {
    // Load recipients from localStorage (empty by default)
    const savedRecipients = localStorage.getItem('extractingo-recipients');
    if (savedRecipients) {
      document.getElementById('recipient-emails').value = savedRecipients;
      this.updateEmailStats();
    }
    
    // Load subject from localStorage
    const savedSubject = localStorage.getItem('extractingo-subject');
    if (savedSubject) {
      document.getElementById('email-subject').value = savedSubject;
      document.getElementById('subject-length').textContent = savedSubject.length;
    }
    
    // Load body from localStorage (empty by default)
    const savedBody = localStorage.getItem('extractingo-body');
    if (savedBody) {
      document.getElementById('email-body').value = savedBody;
      document.getElementById('body-length').textContent = savedBody.length;
    }
    
    // Load from name and email
    const savedFromName = localStorage.getItem('extractingo-from-name');
    const savedFromEmail = localStorage.getItem('extractingo-from-email');
    
    if (savedFromName) {
      document.getElementById('from-name').value = savedFromName;
    }
    
    if (savedFromEmail) {
      document.getElementById('from-email').value = savedFromEmail;
    }
  }

  saveRecipients() {
    const recipients = document.getElementById('recipient-emails').value;
    localStorage.setItem('extractingo-recipients', recipients);
  }

  saveSubject() {
    const subject = document.getElementById('email-subject').value;
    localStorage.setItem('extractingo-subject', subject);
  }

  saveBody() {
    const body = document.getElementById('email-body').value;
    localStorage.setItem('extractingo-body', body);
  }

  updateYear() {
    document.getElementById('currentYear').textContent = new Date().getFullYear();
  }

  updateEmailStats() {
    const text = document.getElementById('recipient-emails').value;
    const lines = text.split('\n').filter(line => line.trim());
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    
    let validCount = 0;
    let invalidCount = 0;
    const emailMap = new Map();
    
    lines.forEach(line => {
      const email = line.trim();
      if (emailRegex.test(email)) {
        validCount++;
        emailMap.set(email, (emailMap.get(email) || 0) + 1);
      } else if (email.includes('@')) {
        invalidCount++;
      }
    });
    
    const duplicates = Array.from(emailMap.values()).filter(count => count > 1).length;
    const total = validCount + invalidCount;
    
    this.emails = Array.from(emailMap.keys());
    
    // Update stats display
    document.getElementById('valid-count').textContent = validCount;
    document.getElementById('invalid-count').textContent = invalidCount;
    document.getElementById('total-count').textContent = total;
    document.getElementById('duplicates-count').textContent = duplicates;
  }

  scanForVariables() {
    const subject = document.getElementById('email-subject').value;
    const body = document.getElementById('email-body').value;
    const allText = subject + ' ' + body;
    
    // Find all variables in format {variable}
    const variableRegex = /\{([^}]+)\}/g;
    let match;
    const detectedVariables = new Set();
    
    while ((match = variableRegex.exec(allText)) !== null) {
      detectedVariables.add(match[1]);
    }
    
    // Update UI
    const variables = Array.from(detectedVariables);
    const count = variables.length;
    
    if (count > 0) {
      document.getElementById('variable-detection').classList.remove('hidden');
      document.getElementById('variable-count').textContent = count;
      
      const variablesList = variables.map(variable => 
        `<span class="variable-highlight inline-block mr-2 mb-1">{${variable}}</span>`
      ).join('');
      
      document.getElementById('detected-variables').innerHTML = variablesList;
    } else {
      document.getElementById('variable-detection').classList.add('hidden');
    }
  }

  extractNameFromEmail(email) {
    if (!document.getElementById('auto-detect-names').checked) {
      return '';
    }
    
    try {
      const [localPart] = email.split('@');
      if (!localPart) return '';
      
      // Common patterns: first.last, first_last, first-last, firstlast
      let nameParts = localPart.split(/[._-]/);
      
      if (nameParts.length === 1 && localPart.length > 5) {
        // Single word - try to split camelCase
        nameParts = localPart.replace(/([a-z])([A-Z])/g, '$1 $2').split(' ');
      }
      
      if (nameParts.length >= 2) {
        const firstName = this.formatName(nameParts[0]);
        const lastName = this.formatName(nameParts.slice(1).join(' '));
        return `${firstName} ${lastName}`.trim();
      } else if (nameParts.length === 1) {
        return this.formatName(nameParts[0]);
      }
    } catch (error) {
      console.error('Error extracting name:', error);
    }
    
    return '';
  }

  extractCompanyFromEmail(email) {
    try {
      const [, domain] = email.split('@');
      if (!domain) return '';
      
      const companyParts = domain.split('.');
      return companyParts[0]
        .replace(/[^a-zA-Z]/g, ' ')
        .split(' ')
        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
        .join(' ');
    } catch (error) {
      return '';
    }
  }

  formatName(name) {
    if (!document.getElementById('auto-capitalize').checked) {
      return name;
    }
    
    // Remove numbers and special characters
    let formatted = name.replace(/[0-9]/g, '').replace(/[^a-zA-Z]/g, ' ');
    
    // Capitalize each word
    formatted = formatted.split(' ')
      .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
      .join(' ')
      .trim();
    
    return formatted || name;
  }

  validateEmails() {
    this.updateEmailStats();
    const valid = parseInt(document.getElementById('valid-count').textContent);
    const invalid = parseInt(document.getElementById('invalid-count').textContent);
    
    if (invalid === 0) {
      this.showNotification(`✅ All ${valid} emails are valid!`, 'success');
    } else {
      this.showNotification(`⚠️ Found ${invalid} invalid email formats`, 'warning');
    }
  }

  checkSubjectSpam() {
    const subject = document.getElementById('email-subject').value.toLowerCase();
    const issues = [];
    
    // Common spam trigger words
    const spamTriggers = [
      { word: 'free', points: 3 },
      { word: 'urgent', points: 2 },
      { word: 'buy now', points: 3 },
      { word: 'click here', points: 2 },
      { word: 'discount', points: 2 },
      { word: 'limited time', points: 2 },
      { word: '!!!', points: 3 },
      { word: '$$$', points: 3 },
      { word: '100% free', points: 4 },
      { word: 'act now', points: 2 }
    ];
    
    let spamScore = 0;
    
    spamTriggers.forEach(trigger => {
      if (subject.includes(trigger.word)) {
        spamScore += trigger.points;
        issues.push(`Contains "${trigger.word}" (+${trigger.points} points)`);
      }
    });
    
    // Check for all caps
    const capsRatio = (subject.match(/[A-Z]/g) || []).length / subject.length;
    if (capsRatio > 0.5 && subject.length > 10) {
      spamScore += 2;
      issues.push('Too many capital letters (+2 points)');
    }
    
    // Update display
    const spamCheckDiv = document.getElementById('subject-spam-check');
    const scoreElement = document.getElementById('subject-spam-score');
    const issuesElement = document.getElementById('subject-spam-issues');
    
    if (subject.length > 0) {
      spamCheckDiv.classList.remove('hidden');
      
      if (spamScore === 0) {
        scoreElement.className = 'spam-score spam-score-low';
        scoreElement.textContent = 'Low Risk';
        issuesElement.innerHTML = '<div class="spam-fixed">✓ No spam triggers detected</div>';
      } else if (spamScore <= 3) {
        scoreElement.className = 'spam-score spam-score-medium';
        scoreElement.textContent = 'Medium Risk';
        issuesElement.innerHTML = issues.map(issue => 
          `<div class="spam-issue">⚠️ ${issue}</div>`
        ).join('');
      } else {
        scoreElement.className = 'spam-score spam-score-high';
        scoreElement.textContent = 'High Risk';
        issuesElement.innerHTML = issues.map(issue => 
          `<div class="spam-issue">❌ ${issue}</div>`
        ).join('');
      }
    } else {
      spamCheckDiv.classList.add('hidden');
    }
  }

  checkSpam() {
    const subject = document.getElementById('email-subject').value;
    const body = document.getElementById('email-body').value;
    
    if (!subject && !body) {
      this.showNotification('Please enter subject and body to check spam score', 'warning');
      return;
    }
    
    let spamScore = 0;
    const issues = [];
    const suggestions = [];
    
    // Subject checks
    const subjectLower = subject.toLowerCase();
    const subjectSpamWords = ['free', 'urgent', 'buy now', 'click here', '!!!', '$$$'];
    subjectSpamWords.forEach(word => {
      if (subjectLower.includes(word)) {
        spamScore += 2;
        issues.push(`Subject contains "${word}"`);
      }
    });
    
    // Body checks
    const bodyLower = body.toLowerCase();
    const bodySpamWords = [
      { word: 'free', points: 1 },
      { word: 'money', points: 2 },
      { word: 'winner', points: 3 },
      { word: 'click here', points: 2 },
      { word: 'unsubscribe', points: 1 },
      { word: 'limited time', points: 2 },
      { word: 'act now', points: 2 }
    ];
    
    bodySpamWords.forEach(trigger => {
      if (bodyLower.includes(trigger.word)) {
        spamScore += trigger.points;
        issues.push(`Body contains "${trigger.word}" (+${trigger.points} points)`);
      }
    });
    
    // Check for too many links
    const linkCount = (body.match(/https?:\/\/[^\s]+/g) || []).length;
    if (linkCount > 3) {
      spamScore += 3;
      issues.push(`Too many links (${linkCount} found, +3 points)`);
      suggestions.push('Reduce the number of links to 1-2');
    }
    
    // Check for personalization
    if (!body.includes('{name}') && !body.includes('{company}')) {
      spamScore += 1;
      suggestions.push('Add personalization variables like {name} or {company}');
    }
    
    // Update display
    const spamResults = document.getElementById('spam-results');
    const overallScore = document.getElementById('overall-spam-score');
    const issuesElement = document.getElementById('spam-issues');
    const suggestionsElement = document.getElementById('spam-suggestions');
    
    spamResults.classList.remove('hidden');
    
    if (spamScore === 0) {
      overallScore.className = 'spam-score spam-score-low';
      overallScore.textContent = 'Excellent (0/20)';
      issuesElement.innerHTML = '<div class="spam-fixed">✓ No spam issues detected!</div>';
    } else if (spamScore <= 5) {
      overallScore.className = 'spam-score spam-score-low';
      overallScore.textContent = `Good (${spamScore}/20)`;
    } else if (spamScore <= 10) {
      overallScore.className = 'spam-score spam-score-medium';
      overallScore.textContent = `Moderate (${spamScore}/20)`;
    } else {
      overallScore.className = 'spam-score spam-score-high';
      overallScore.textContent = `High Risk (${spamScore}/20)`;
    }
    
    if (issues.length > 0) {
      issuesElement.innerHTML = issues.map(issue => 
        `<div class="spam-issue">⚠️ ${issue}</div>`
      ).join('');
    }
    
    if (suggestions.length > 0) {
      suggestionsElement.innerHTML = '<strong>Suggestions:</strong><br>' + 
        suggestions.map(s => `• ${s}`).join('<br>');
    }
    
    this.showNotification(`Spam score: ${spamScore}/20 (lower is better)`, 'info');
  }

  clearRecipients() {
    document.getElementById('recipient-emails').value = '';
    this.updateEmailStats();
    this.scanForVariables();
    this.saveRecipients(); // Save empty recipients
    this.showNotification('Recipients cleared', 'info');
  }

  generateEmails() {
    const recipients = document.getElementById('recipient-emails').value;
    const subject = document.getElementById('email-subject').value;
    const body = document.getElementById('email-body').value;
    
    if (!recipients.trim()) {
      this.showNotification('Please add recipient emails', 'error');
      return;
    }
    
    if (!subject.trim()) {
      this.showNotification('Please enter a subject line', 'error');
      return;
    }
    
    if (!body.trim()) {
      this.showNotification('Please enter email content', 'error');
      return;
    }
    
    // Show loading briefly
    const button = event?.target || document.querySelector('button[onclick*="generateEmails"]');
    const originalText = button.innerHTML;
    button.innerHTML = '<div class="spinner mr-2"></div> Generating...';
    button.disabled = true;
    
    // Generate instantly (no delay)
    setTimeout(() => {
      // Generate email list with personalization
      this.generatedEmails = this.emails.map((email, index) => {
        const personalizedData = this.personalizeEmail(email, subject, body);
        const mailtoUrl = this.createMailtoUrl(email, personalizedData.subject, personalizedData.body);
        
        return {
          id: index + 1,
          email: email,
          status: 'pending',
          openedInGmail: false,
          selected: false,
          mailtoUrl: mailtoUrl,
          personalizedData: personalizedData,
          isPersonalized: personalizedData.isPersonalized
        };
      });
      
      // Show generated emails section
      document.getElementById('generated-emails-section').classList.remove('hidden');
      
      // Render emails
      this.renderGeneratedEmails();
      
      // Update button
      button.innerHTML = originalText;
      button.disabled = false;
      
      // Save data
      this.saveSubject();
      this.saveBody();
      this.saveRecipients();
      
      // Show success message
      const personalizedCount = this.generatedEmails.filter(e => e.isPersonalized).length;
      this.showNotification(`✅ Generated ${this.generatedEmails.length} emails! ${personalizedCount} personalized.`, 'success');
      
      // Scroll to generated emails
      document.getElementById('generated-emails-section').scrollIntoView({ behavior: 'smooth' });
    }, 300); // Very brief loading indicator
  }

  personalizeEmail(email, subject, body) {
    let personalizedSubject = subject;
    let personalizedBody = body;
    let isPersonalized = false;
    
    // Extract name and company
    const name = this.extractNameFromEmail(email);
    const company = this.extractCompanyFromEmail(email);
    
    // Replace variables
    if (name && personalizedSubject.includes('{name}')) {
      personalizedSubject = personalizedSubject.replace(/{name}/gi, name);
      isPersonalized = true;
    }
    
    if (name && personalizedBody.includes('{name}')) {
      personalizedBody = personalizedBody.replace(/{name}/gi, name);
      isPersonalized = true;
    }
    
    if (company && personalizedSubject.includes('{company}')) {
      personalizedSubject = personalizedSubject.replace(/{company}/gi, company);
      isPersonalized = true;
    }
    
    if (company && personalizedBody.includes('{company}')) {
      personalizedBody = personalizedBody.replace(/{company}/gi, company);
      isPersonalized = true;
    }
    
    // Replace date if included
    if (document.getElementById('include-date').checked) {
      const currentDate = new Date().toLocaleDateString('en-US', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });
      
      personalizedSubject = personalizedSubject.replace(/{date}/gi, currentDate);
      personalizedBody = personalizedBody.replace(/{date}/gi, currentDate);
    }
    
    // Replace your_name
    const fromName = document.getElementById('from-name').value || 'Extractingo Team';
    personalizedSubject = personalizedSubject.replace(/{your_name}/gi, fromName);
    personalizedBody = personalizedBody.replace(/{your_name}/gi, fromName);
    
    return {
      subject: personalizedSubject,
      body: personalizedBody,
      isPersonalized: isPersonalized,
      name: name,
      company: company
    };
  }

  createMailtoUrl(email, subject, body) {
    // Always use mailto: protocol (works on both mobile and desktop)
    // mailto: opens the default email app on the device
    
    // Get sender info
    const fromName = document.getElementById('from-name').value || '';
    const fromEmail = document.getElementById('from-email').value || '';
    
    // Create personalized body
    let personalizedBody = body;
    
    // Add sender info if provided
    if (fromName || fromEmail) {
      personalizedBody += '\n\n---\n';
      if (fromName) personalizedBody += `From: ${fromName}\n`;
      if (fromEmail) personalizedBody += `Reply-to: ${fromEmail}`;
    }
    
    // Encode for URL
    const encodedSubject = encodeURIComponent(subject);
    const encodedBody = encodeURIComponent(personalizedBody);
    
    // Create mailto: URL
    return `mailto:${email}?subject=${encodedSubject}&body=${encodedBody}`;
  }

  openEmailInGmail(emailId) {
    const email = this.generatedEmails.find(e => e.id === emailId);
    if (!email || !email.mailtoUrl) return;
    
    // Always use mailto: protocol to open email app
    // This creates a hidden anchor and clicks it to avoid popup blockers
    const anchor = document.createElement('a');
    anchor.href = email.mailtoUrl;
    anchor.style.display = 'none';
    anchor.target = '_blank';
    document.body.appendChild(anchor);
    anchor.click();
    document.body.removeChild(anchor);
    
    // Mark as opened
    email.openedInGmail = true;
    email.status = 'opened';
    
    // Update display
    this.renderGeneratedEmails();
    this.updateOpenedCount();
    
    // Show notification
    const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    const message = isMobile ? 
      `Opening email app for ${email.email}` : 
      `Opening email for ${email.email}`;
    this.showNotification(message, 'info');
  }

  renderGeneratedEmails() {
    const container = document.getElementById('generated-emails-container');
    let filteredEmails = this.generatedEmails;
    
    // Filter by current tab
    if (this.currentTab === 'opened') {
      filteredEmails = this.generatedEmails.filter(email => email.openedInGmail);
    } else if (this.currentTab === 'pending') {
      filteredEmails = this.generatedEmails.filter(email => !email.openedInGmail);
    }
    
    container.innerHTML = filteredEmails.map(email => `
      <div class="email-item ${email.openedInGmail ? 'gmail-opened' : ''} ${email.selected ? 'selected' : ''} ${email.isPersonalized ? 'personalized' : ''}" 
           onclick="app.handleEmailClick(event, ${email.id})" 
           data-id="${email.id}">
        <div class="email-status status-${email.status}"></div>
        <div class="email-number">${email.id}.</div>
        <div class="email-address">${email.email}</div>
        ${email.isPersonalized ? '<span class="personalization-badge">Personalized</span>' : ''}
        <div class="gmail-icon">
          ${email.openedInGmail ? 
            '<i class="ri-check-double-line text-google-green" title="Opened in Email App"></i>' : 
            '<i class="ri-mail-line" title="Click to open in Email App"></i>'}
        </div>
      </div>
    `).join('');
    
    // Update selected count
    this.updateSelectedCount();
  }

  handleEmailClick(event, emailId) {
    const email = this.generatedEmails.find(e => e.id === emailId);
    if (!email) return;
    
    // Ctrl+Click for multi-select
    if (event.ctrlKey || event.metaKey) {
      email.selected = !email.selected;
      if (email.selected) {
        this.selectedEmails.add(emailId);
      } else {
        this.selectedEmails.delete(emailId);
      }
      this.renderGeneratedEmails();
      return;
    }
    
    // Single click - open in Email App using mailto:
    this.openEmailInGmail(emailId);
  }

  openSelectedInGmail() {
    const selectedEmails = this.generatedEmails.filter(email => email.selected);
    
    if (selectedEmails.length === 0) {
      // If none selected, open first pending
      const pendingEmails = this.generatedEmails.filter(email => !email.openedInGmail);
      if (pendingEmails.length === 0) {
        this.showNotification('No pending emails to open', 'warning');
        return;
      }
      
      this.openEmailInGmail(pendingEmails[0].id);
    } else {
      // Open selected emails (no delays)
      selectedEmails.forEach(email => {
        this.openEmailInGmail(email.id);
      });
      
      this.showNotification(`Opened ${selectedEmails.length} emails in Email App`, 'info');
    }
  }

  exportEmails() {
    const emailsToExport = this.generatedEmails
      .filter(email => email.selected || this.selectedEmails.size === 0)
      .map(email => email.email);
    
    if (emailsToExport.length === 0) {
      this.showNotification('No emails to export', 'warning');
      return;
    }
    
    const emailList = emailsToExport.join('\n');
    const blob = new Blob([emailList], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'extractingo_emails.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    this.showNotification(`Exported ${emailsToExport.length} emails to file`, 'success');
  }

  showEmailTab(tabName) {
    this.currentTab = tabName;
    
    // Update tab buttons
    document.querySelectorAll('.tab-button').forEach(button => {
      button.classList.remove('active');
      if (button.getAttribute('data-tab') === tabName) {
        button.classList.add('active');
      }
    });
    
    // Re-render emails
    this.renderGeneratedEmails();
  }

  updateSelectedCount() {
    const count = this.generatedEmails.filter(e => e.selected).length;
    document.getElementById('selected-count').textContent = count;
  }

  updateOpenedCount() {
    const count = this.generatedEmails.filter(e => e.openedInGmail).length;
    document.getElementById('opened-count').textContent = count;
  }

  previewEmail() {
    const subject = document.getElementById('email-subject').value;
    const body = document.getElementById('email-body').value;
    
    if (!subject.trim() || !body.trim()) {
      this.showNotification('Please fill in subject and body to preview', 'warning');
      return;
    }
    
    // Show preview with personalization example
    if (this.emails.length > 0) {
      const sampleEmail = this.emails[0];
      const personalized = this.personalizeEmail(sampleEmail, subject, body);
      
      const preview = `SAMPLE FOR: ${sampleEmail}\n\nSubject: ${personalized.subject}\n\nBody:\n${personalized.body.substring(0, 300)}${personalized.body.length > 300 ? '...' : ''}`;
      alert(preview);
    } else {
      const preview = `Subject: ${subject}\n\nBody:\n${body.substring(0, 300)}${body.length > 300 ? '...' : ''}`;
      alert(preview);
    }
  }

  testInGmail() {
    const subject = document.getElementById('email-subject').value;
    const body = document.getElementById('email-body').value;
    const testEmail = 'test@example.com';
    
    if (!subject || !body) {
      this.showNotification('Please enter subject and body first', 'warning');
      return;
    }
    
    const personalized = this.personalizeEmail(testEmail, subject, body);
    const mailtoUrl = this.createMailtoUrl(testEmail, personalized.subject, personalized.body);
    
    // Use mailto: for testing too
    const anchor = document.createElement('a');
    anchor.href = mailtoUrl;
    anchor.style.display = 'none';
    anchor.target = '_blank';
    document.body.appendChild(anchor);
    anchor.click();
    document.body.removeChild(anchor);
    
    this.showNotification('Opening test email in your email app', 'info');
  }

  toggleAdvancedOptions() {
    const options = document.getElementById('advanced-options');
    const button = event.target.closest('button');
    
    options.classList.toggle('hidden');
    
    if (options.classList.contains('hidden')) {
      button.innerHTML = '<i class="ri-settings-3-line mr-2"></i>Advanced Options';
    } else {
      button.innerHTML = '<i class="ri-settings-3-line mr-2"></i>Hide Options';
    }
  }

  showNotification(message, type = 'info') {
    const notification = document.getElementById('notification');
    const text = document.getElementById('notification-text');
    
    notification.className = `notification ${type}`;
    text.textContent = message;
    notification.classList.add('show');
    
    setTimeout(() => {
      notification.classList.remove('show');
    }, 3000);
  }
}

// Formatting functions
function formatText(command) {
  const textarea = document.getElementById('email-body');
  const start = textarea.selectionStart;
  const end = textarea.selectionEnd;
  const selectedText = textarea.value.substring(start, end);
  
  let formattedText = '';
  switch (command) {
    case 'bold':
      formattedText = `**${selectedText}**`;
      break;
    case 'italic':
      formattedText = `*${selectedText}*`;
      break;
  }
  
  textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
  textarea.focus();
  textarea.setSelectionRange(start + formattedText.length, start + formattedText.length);
  
  // Update character count
  document.getElementById('body-length').textContent = textarea.value.length;
}

function insertVariable(variable) {
  const textarea = document.getElementById('email-body');
  const start = textarea.selectionStart;
  const variableText = `{${variable}}`;
  
  textarea.value = textarea.value.substring(0, start) + variableText + textarea.value.substring(start);
  textarea.focus();
  textarea.setSelectionRange(start + variableText.length, start + variableText.length);
  
  // Update character count
  document.getElementById('body-length').textContent = textarea.value.length;
  
  // Update variable detection
  if (app) app.scanForVariables();
}

// Load sample emails function
function loadSampleEmails() {
  app.loadSampleData();
}

// Initialize app
let app;
document.addEventListener('DOMContentLoaded', () => {
  app = new EmailGeneratorApp();
});

// Global functions for HTML onclick handlers
function validateEmails() { app.validateEmails(); }
function clearRecipients() { app.clearRecipients(); }
function checkSpam() { app.checkSpam(); }
function generateEmails() { app.generateEmails(); }
function previewEmail() { app.previewEmail(); }
function testInGmail() { app.testInGmail(); }
function toggleAdvancedOptions() { app.toggleAdvancedOptions(); }
function showEmailTab(tab) { app.showEmailTab(tab); }
function openSelectedInGmail() { app.openSelectedInGmail(); }
function exportEmails() { app.exportEmails(); }
</script>
</body>
</html>